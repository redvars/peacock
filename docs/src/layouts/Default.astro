---
interface Props {
  title?: string;
  description?: string;
  root?: boolean;
  keywords?: string;
  classes?: string;
}

const { title, root, description, keywords, classes } = Astro.props;

import Layout from './Base.astro';
import site from '../_data/site.json';
import componentsDetails from '../_data/componentsDetails.json';

const searchItems = componentsDetails.components.map(component => ({
  label: component.metadata.label,
  value: component.metadata.name
}));
---

<Layout title={title} description={description} keywords={keywords}>
  <div class="page-with-navigation">
    <div class="side-navigation surface-dim">
      <a class="link search-button" id="search-btn" href="#">

        <pc-icon name="search"></pc-icon>

      </a>

      <a class="home link no-style nav-item" href="/#">
        <div class="item">
          <div class='icon'>
            <img src="/assets/img/logo-plain.png" class="logo" alt="peacock">
          </div>
          <span class='text-label'>Home</span>
        </div>
      </a>

      <a class="components link no-style nav-item" href='/components'>
        <div class="item">
        <pc-icon class="icon" name="settings"></pc-icon>
          <span class='text-label'>Components</span>
        </div>
      </a>

      <a class="color link no-style nav-item" href='/color'>
        <div class="item">
        <pc-icon class="icon" name="palette"></pc-icon>
          <span class='text-label'>Colors</span>
        </div>
      </a>

      <a class="color link no-style nav-item" href='/typography'>
        <div class="item">
          <pc-icon class="icon" name="font_download"></pc-icon>
          <span class='text-label'>Typography</span>
        </div>
      </a>

    </div>

    <div class="page-context-wrapper">
      <nav class="top-nav">
        <goat-header color="white" dark-mode-color="black" class={`header ${!root ? 'border' : ''}`}>
          <div slot="left">
            <goat-header-brand logo="/assets/img/logo-plain.png" href="/#" name={site.title}></goat-header-brand>

            <!--goat-header-action
          class='hide-tablet-portrait-below'
          href='/components#'>
          Docs
        </goat-header-action-->

            <goat-header-action class="hide-tablet-portrait-below" href="/components#"> Components </goat-header-action>
          </div>

          <div slot="right">

            <pc-button color="primary" size="sm" variant="simple" target="_blank" class="hide-tablet-portrait-below sponsor-btn" href="https://github.com/sponsors/shivajivarma">
              Sponsor
            </pc-button>

            <pc-divider class="header-divider hide-tablet-portrait-below" vertical></pc-divider>

            <goat-header-action class="dir-switcher hide-tablet-portrait-below" aria-label="Direction switcher">LTR </goat-header-action>

            <goat-header-action id="theme-switcher" icon="sun" class="theme-switcher" aria-label="Theme switcher"></goat-header-action>

            <goat-header-action icon="logo--github" aria-label="View Github" href={`https://github.com/${site.github_username}/${site.github_project}`} target="_blank"
            ></goat-header-action>

            <goat-header-action class="show-tablet-portrait-below" aria-label="Menu" id="header-menu-btn" icon="menu"></goat-header-action>
          </div>
        </goat-header>
      </nav>

      <div id="header-menu">
        <div class="header-menu-head">
          <pc-button id="header-menu-close-btn" variant="text" icon="close" color="secondary" size="lg" dark-mode-color="white" aria-label="Close menu"></pc-button>
        </div>

        <goat-menu class="header-menu-list no-border">
          <goat-menu-item href="/components#">
            <pc-icon name="roadmap" slot="start" size="sm"></pc-icon>&nbsp; Components
          </goat-menu-item>
          <goat-menu-item href="/blog#">
            <pc-icon name="blog" slot="start" size="sm"></pc-icon>&nbsp; Blog
          </goat-menu-item>
          <goat-menu-item href="https://github.com/sponsors/shivajivarma" target="_blank" icon="roadmap">
            <pc-icon name="currency--rupee" slot="start" size="sm"></pc-icon>&nbsp; Sponsor
          </goat-menu-item>
        </goat-menu>
      </div>

      <main class={classes}>
        <slot />
      </main>
    </div>
  </div>

  <div slot="page-end">
    <!-- Scripts -->
    <script src="/assets/js/main.js" is:inline></script>
  </div>

  <div id="search-header-container">
    <div id="search-container-overlay"></div>
    <goat-select id="site-search" search="contains" layer="01" hide-dropdown-icon placeholder="Type '/' for search">
      <pc-icon slot="start" name="search"></pc-icon>
    </goat-select>
  </div>

  <script is:inline define:vars={{ searchItems }}>
    document.addEventListener('DOMContentLoaded', function () {
      const searchBtn = document.querySelector('#search-btn');
      const searchContainerOverlay = document.querySelector('#search-container-overlay');
      const search = document.querySelector('#site-search');

      searchBtn.addEventListener('click', function () {
        openSearchContainer();
      });

      searchContainerOverlay.addEventListener('click', function () {
        const searchContainer = document.querySelector('#search-header-container');
        searchContainer.removeAttribute('open');
      });

      if (search) {
        // prettier-ignore
        search.items = searchItems;
        search.items = search.items.filter(item => !!item.label);
        search.addEventListener('goat-select--change', function (e) {
          window.location.href = '/components/' + e.detail.value;
        });

        search.addEventListener('goat-select--enter', function (e) {
          if (e.detail.currentItems.length > 0) window.location.href = '/components/' + e.detail.currentItems[0].value;
        });

        document.addEventListener('keydown', function (e) {
          if (e.key === '/') {
            const path = e.composedPath();
            for (const elm of path) {
              if (elm.tagName === 'GOAT-INPUT' || elm.tagName === 'GOAT-CODE-EDITOR' || elm.tagName === 'GOAT-TEXTAREA' || elm.tagName === 'INPUT') {
                return;
              }
            }
            e.preventDefault();
            openSearchContainer();
          }
        });
      }

      function openSearchContainer() {
        const searchContainer = document.querySelector('#search-header-container');
        searchContainer.toggleAttribute('open');
        setTimeout(() => {
          search.openSelectList();
        }, 300);
      }
    });
  </script>
</Layout>
